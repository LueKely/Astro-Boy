---
import Layout from '../../layouts/Layout.astro';
import { Link } from '../../components/composables/link';
import { CartridgeLayout } from '../../components/layout/CatridgeLayout';
---

<Layout title="Cartridge">
    <main>
        <section>
            <CartridgeLayout />
        </section>
    </main>
</Layout>
<script>
    import { Gameboy } from '../../lib/Gameboy';
    import { loadFile } from '../../lib/utils/File_Utils';

    const input = document.getElementById('fileInput');
    const button = document.querySelector('.button');
    const clearBtn = document.querySelector('.clear');
    const output = document.getElementById('output');

    let gameboy: Gameboy | null = null;
    input?.addEventListener('change', async (e) => {
        if (!output) throw new Error('Output element missing');

        const game = await loadFile(e);
        gameboy = new Gameboy(game);

        console.log(gameboy?.cartridge.getCartridgeHeaderRaw());
        console.log(gameboy?.cartridge.inferCartridgeHeader());

        gameboy.run();

        gameboy.cartridge.checkSum();
        output.innerText = 'Game Loaded';
    });

    button?.addEventListener('click', () => {
        gameboy?.stop();
    });
</script>
